angular.module("openit.controllers",[]).factory("Data",function(){return{message:"I'm data from a service"}}).controller("AppCtrl",function(e,b,d,a,f,c){var g="<h3 align='center'><i class='icon button-icon icon ion-load-c spin'></i></i>Updating license status</h3>";e.server={};b.fromTemplateUrl("templates/login.html",{scope:e}).then(function(h){e.modal=h});e.closeLogin=function(){e.modal.hide()};e.login=function(){e.modal.show()};e.doLogin=function(){console.log("Login in to server",e.server);var h=getServerUrl();a.get(h).then(function(i){VERBOSE("Success",i);LicenseStatus=convertToJson(i.data);prepareDataListing();if(LicenseStatus.length!=0&&LicenseStatus.realtime!=null){d.listing=LicenseStatus.realtime.productlist}d.collectiontime=epochToDate(LicenseStatus.realtime.meta.content)},function(i){ERROR("Failed to retrieved data")});e.closeLogin();c.path("mainlist/:products/:all");$ionicViewService.clearHistory()}}).directive("search",function(){return{restrict:"E",transclude:true,scope:{title:"@"},template:'<div>\n  <h3 ng-click="toggleContent()">{{title}}</h3>\n           <div ng-show="isContentVisible" ng-transclude></div>\n<div>',link:function(a){a.isContentVisible=false;a.toggleContent=function(){a.isContentVisible=!a.isContentVisible}}}}).controller("MainListCtrl",function(d,c,e,a,b){var h="<h3 align='center'><i class='icon button-icon icon ion-load-c spin'></i></i>Updating license status</h3>";d.defaultlimit=25;d.category=capitaliseFirstLetter(e.category.substring(1));var g=e.id.substring(1);if(LicenseStatus.length==0){c.listing=[];c.listing.push({html:h});VERBOSE("License_status length is empty force update...");var f=getServerUrl();VERBOSE("Retrieving data from "+f);a.get(f).then(function(j){VERBOSE("Success",j);LicenseStatus=convertToJson(j.data);prepareDataListing();if(LicenseStatus.length!=0&&LicenseStatus.realtime!=null){c.listing=i()}c.collectiontime=epochToDate(LicenseStatus.realtime.meta.content)},function(j){ERROR("Failed to retrieved data");d.$broadcast("scroll.refreshComplete")})}if(LicenseStatus.length!=0){c.listing=i()}function i(){DEBUG("Preparing data....");prepareDataListing();if(LicenseStatus==undefined){return}var j=[];if(d.category.toLowerCase()=="products"){j=LicenseStatus.realtime.productlist}else{if(d.category.toLowerCase()=="features"){j=LicenseStatus.realtime.featureslist}else{if(d.category.toLowerCase()=="users"){j=LicenseStatus.realtime.userslist}}}return j}d.refreshListing=function(){var k=false;c.listing=[];c.listing.push({html:h});d.search="";VERBOSE("updating license status via list drag.");var j=getServerUrl();VERBOSE("Retrieving data from "+j);a.get(j).then(function(l){VERBOSE("Success",l);LicenseStatus=convertToJson(l.data);if(LicenseStatus.length!=0){c.listing=i()}c.collectiontime=epochToDate(LicenseStatus.realtime.meta.content)},function(l){showError("Connection error","Failed to retrieve license status data. Please check your server configurations or mobile data settings.")});d.$broadcast("scroll.refreshComplete")}}).controller("SubListCtrl",function(b,c,a){b.refreshXMLData=function(){VERBOSE("Refreshing xml data");var d=getServerUrl();VERBOSE("Retrieving data from "+d);a.get(d).then(function(e){VERBOSE("Success",e);var f=parseXML(e.data);License_status=parseLicenseStatus(f);b.$broadcast("scroll.refreshComplete")},function(e){showError(" Error",e)})}});