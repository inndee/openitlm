function xml2json(d,b){var c={toObj:function(l){var j={};if(l.nodeType==1){if(l.attributes.length){for(var g=0;g<l.attributes.length;g++){j[l.attributes[g].nodeName]=(l.attributes[g].value||"").toString()}}if(l.firstChild){var k=0,e=0,f=false;for(var h=l.firstChild;h;h=h.nextSibling){if(h.nodeType==1){f=true}else{if(h.nodeType==3&&h.nodeValue.match(/[^ \f\n\r\t\v]/)){k++}else{if(h.nodeType==4){e++}}}}if(f){if(k<2&&e<2){c.removeWhite(l);for(var h=l.firstChild;h;h=h.nextSibling){if(h.nodeType==3){j["#text"]=c.escape(h.nodeValue)}else{if(h.nodeType==4){j["#cdata"]=c.escape(h.nodeValue)}else{if(j[h.nodeName]){if(j[h.nodeName] instanceof Array){j[h.nodeName][j[h.nodeName].length]=c.toObj(h)}else{j[h.nodeName]=[j[h.nodeName],c.toObj(h)]}}else{j[h.nodeName]=c.toObj(h)}}}}}else{if(!l.attributes.length){j=c.escape(c.innerXml(l))}else{j["#text"]=c.escape(c.innerXml(l))}}}else{if(k){if(!l.attributes.length){j=c.escape(c.innerXml(l))}else{j["#text"]=c.escape(c.innerXml(l))}}else{if(e){if(e>1){j=c.escape(c.innerXml(l))}else{for(var h=l.firstChild;h;h=h.nextSibling){j["#cdata"]=c.escape(h.nodeValue)}}}}}}if(!l.attributes.length&&!l.firstChild){j=null}}else{if(l.nodeType==9){j=c.toObj(l.documentElement)}else{alert("unhandled node type: "+l.nodeType)}}return j},toJson:function(p,l,g){var h=l?('"'+l+'"'):"";if(p instanceof Array){for(var f=0,k=p.length;f<k;f++){p[f]=c.toJson(p[f],"",g+"\t")}h+=(l?":[":"[")+(p.length>1?("\n"+g+"\t"+p.join(",\n"+g+"\t")+"\n"+g):p.join(""))+"]"}else{if(p==null){h+=(l&&":")+"null"}else{if(typeof(p)=="object"){var e=[];for(var j in p){e[e.length]=c.toJson(p[j],j,g+"\t")}h+=(l?":{":"{")+(e.length>1?("\n"+g+"\t"+e.join(",\n"+g+"\t")+"\n"+g):e.join(""))+"}"}else{if(typeof(p)=="string"){h+=(l&&":")+'"'+p.toString()+'"'}else{h+=(l&&":")+p.toString()}}}}return h},innerXml:function(g){var h="";if("innerHTML" in g){h=g.innerHTML}else{var e=function(l){var m="";if(l.nodeType==1){m+="<"+l.nodeName;for(var k=0;k<l.attributes.length;k++){m+=" "+l.attributes[k].nodeName+'="'+(l.attributes[k].nodeValue||"").toString()+'"'}if(l.firstChild){m+=">";for(var j=l.firstChild;j;j=j.nextSibling){m+=e(j)}m+="</"+l.nodeName+">"}else{m+="/>"}}else{if(l.nodeType==3){m+=l.nodeValue}else{if(l.nodeType==4){m+="<![CDATA["+l.nodeValue+"]]>"}}}return m};for(var f=g.firstChild;f;f=f.nextSibling){h+=e(f)}}return h},escape:function(e){return e.replace(/[\\]/g,"\\\\").replace(/[\"]/g,'\\"').replace(/[\n]/g,"\\n").replace(/[\r]/g,"\\r")},removeWhite:function(f){f.normalize();for(var g=f.firstChild;g;){if(g.nodeType==3){if(!g.nodeValue.match(/[^ \f\n\r\t\v]/)){var h=g.nextSibling;f.removeChild(g);g=h}else{g=g.nextSibling}}else{if(g.nodeType==1){c.removeWhite(g);g=g.nextSibling}else{g=g.nextSibling}}}return f}};if(d.nodeType==9){d=d.documentElement}var a=c.toJson(c.toObj(c.removeWhite(d)),d.nodeName,"\t");return"{\n"+b+(b?a.replace(/\t/g,b):a.replace(/\t|\n/g,""))+"\n}"};